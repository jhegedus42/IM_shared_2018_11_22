<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="utils/markdown/pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="what-is-this-"><span class="header-section-number">1</span> What is this ?</h1>
<p>A humble attempt at writing a 'full-stack' end-to-end 'Scala-only' Single-page-app "Hello-World web-framework" with the following properties:</p>
<ul>
<li><p>Server :</p>
<ul>
<li>Event Sourcing</li>
<li>Persistence
<ul>
<li>achieved by journaling all CRUD events</li>
</ul></li>
</ul></li>
<li><p>Client</p>
<ul>
<li>React</li>
<li>Single page application</li>
<li>URL router</li>
<li>State is NOT stored using
<ul>
<li>FLUX</li>
<li>DIODE</li>
<li>REDUX</li>
</ul></li>
<li>State is stored in a Cache
<ul>
<li><p>simple and transparent</p></li>
<li><p>same (relational) data representation as on server</p>
<ul>
<li>relational in the sense :
<ul>
<li>both normalized and denormalized representation of the domain model is possible</li>
<li>references : "primary keys", "foreign keys"</li>
<li>joins, etc ...</li>
</ul></li>
<li>data is contained in <code>case classes</code></li>
</ul></li>
<li><p>can contain both normalized ("Entities") and denormalized data (views)</p></li>
</ul></li>
</ul></li>
<li><p>Domain model</p>
<ul>
<li>Normalized data representation (relational model)</li>
<li>Views that can be denormalized</li>
</ul></li>
<li><p>Communication</p>
<ul>
<li>type-safe RPC calls (poor man's <a href="https://haskell-servant.github.io/">servant</a> for Scala)
<ul>
<li>implemented using type classes</li>
<li>type-safe RPC call interface is available to client and server</li>
</ul></li>
<li>the same data structures (types) can be used in the source code for both
<ul>
<li>the client</li>
<li>the server</li>
</ul></li>
<li>this is possible because : part of the source code is compiled into both
<ul>
<li><code>JVM bytecode</code></li>
<li><code>Javascript</code></li>
</ul></li>
<li>Entities, Views, RPC calls are transmitted as <code>case classes</code> encoded into <code>JSON</code></li>
</ul></li>
</ul>
<h1 id="pre-requeisites"><span class="header-section-number">2</span> Pre-requeisites</h1>
<h2 id="installing-js-dependencies"><span class="header-section-number">2.1</span> Installing JS dependencies</h2>
<p>In <code>node</code> directory run <code>yarn</code> and then <code>./node_modules/.bin/webpack</code>. This will create <code>node/generated.js/index-bundle.js</code> which contains all dependencies "bundled up" into a single JS file.</p>
<h1 id="starting-the-test-server"><span class="header-section-number">3</span> Starting the Test Server</h1>
<p>First, ake sure that in</p>
<pre><code>app.server.RESTService.mocks.TestServerFactory
</code></pre>
<p>the parameter to the function <code>IndexDotHtmlTestTemplate.txt</code> is set to <code>false</code>, so that it reads :</p>
<pre><code>override lazy val rootPageHtml = IndexDotHtmlTestTemplate.txt(false)
</code></pre>
<p>then at the command prompt, run :</p>
<pre><code>utils/runTestServerInSbt.sh
</code></pre>
<p>This compiles and builds everything.</p>
<p>If you want to clear all caches then execute the following command before the above command:</p>
<pre><code>./clean.sh
</code></pre>
<p>then open the browser at <code>http://localhost:8043/</code></p>
<h1 id="testing"><span class="header-section-number">4</span> Testing</h1>
<h2 id="unit-testing-the-server"><span class="header-section-number">4.1</span> Unit testing the server</h2>
<p>Execute the following script:</p>
<pre><code> ./runUnitTestsForServer.sh
</code></pre>
<h3 id="compiling-all-server-side-tests"><span class="header-section-number">4.1.1</span> Compiling all (server side) tests</h3>
<pre><code>sbt
&gt; test:compile
</code></pre>
<h3 id="running-the-unit-tests"><span class="header-section-number">4.1.2</span> Running the unit tests</h3>
<p>We run unit tests for two different types of code:</p>
<ol>
<li>for testing pure JVM bytecode which is compiled for running the the server</li>
<li>for JVM and JS code which is compiled from the same Scala source, which corresponds to :
<ul>
<li>the logic which is used by both the server and by the client, this is a so called "shared-code" that contains mainly:
<ul>
<li>data structures
<ul>
<li>that represent the "domain logic" of the application, because they are used both by the server and by the client to represent and manipulate domain knowledge data</li>
</ul></li>
<li>code for "type-safe" client-server communication
<ul>
<li>for example : what kind of 'commands' can be be sent to the server by the client and what kind of answer can the client expect in return :
<ul>
<li>this has been implemented as type "safely" as possible</li>
<li>this code is used to create type class instances on the server side, which contain the logic that calculates the answer for the client's requests</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<p>First let's clean up the project and execute the package manager In <code>bash</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">./clean.sh</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ex">sbt</span></a></code></pre></div>
<p>then in the <code>sbt</code> shell (I insert extra empty lines below for better readability):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="op">&gt;</span> <span class="ex">clean</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">&gt;</span> <span class="ex">projects</span> <span class="co"># this shows what kind of modules need to be tested </span></a>
<a class="sourceLine" id="cb8-4" title="4">             <span class="kw">(</span><span class="ex">the</span> ones which whave JVM in their name<span class="kw">)</span></a>
<a class="sourceLine" id="cb8-5" title="5">             </a>
<a class="sourceLine" id="cb8-6" title="6">[<span class="ex">info</span>] In file:/Users/joco/dev/IM/im-2018jan/</a>
<a class="sourceLine" id="cb8-7" title="7">[<span class="ex">info</span>]   * im-2018jan</a>
<a class="sourceLine" id="cb8-8" title="8">[<span class="ex">info</span>]     layer_V_JS_client</a>
<a class="sourceLine" id="cb8-9" title="9">[<span class="ex">info</span>]     layer_W_JVM_akka_http_server</a>
<a class="sourceLine" id="cb8-10" title="10">[<span class="ex">info</span>]     layer_X_JVM_stateAccess</a>
<a class="sourceLine" id="cb8-11" title="11">[<span class="ex">info</span>]     layer_Y_JVM_persistence</a>
<a class="sourceLine" id="cb8-12" title="12">[<span class="ex">info</span>]     layer_Z_JVM_and_JS_sharedJS</a>
<a class="sourceLine" id="cb8-13" title="13">[<span class="ex">info</span>]     layer_Z_JVM_and_JS_sharedJVM</a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="op">&gt;</span> <span class="ex">layer_W_JVM_akka_http_server/test</span></a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="ex">...</span> output of tests running ...</a>
<a class="sourceLine" id="cb8-18" title="18"></a>
<a class="sourceLine" id="cb8-19" title="19">[<span class="ex">info</span>] Run completed in 3 seconds, 621 milliseconds.</a>
<a class="sourceLine" id="cb8-20" title="20">[<span class="ex">info</span>] Total number of tests run: 29</a>
<a class="sourceLine" id="cb8-21" title="21">[<span class="ex">info</span>] Suites: completed 8, aborted 0</a>
<a class="sourceLine" id="cb8-22" title="22">[<span class="ex">info</span>] Tests: succeeded 29, failed 0, canceled 0, ignored 0, pending 0</a>
<a class="sourceLine" id="cb8-23" title="23"></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="op">&gt;</span> <span class="ex">layer_X_JVM_stateAccess/test</span></a>
<a class="sourceLine" id="cb8-25" title="25">[<span class="ex">info</span>] Run completed in 19 milliseconds.</a>
<a class="sourceLine" id="cb8-26" title="26">[<span class="ex">info</span>] Total number of tests run: 0</a>
<a class="sourceLine" id="cb8-27" title="27">[<span class="ex">info</span>] Suites: completed 0, aborted 0</a>
<a class="sourceLine" id="cb8-28" title="28">[<span class="ex">info</span>] Tests: succeeded 0, failed 0, canceled 0, ignored 0, pending 0</a>
<a class="sourceLine" id="cb8-29" title="29">[<span class="ex">info</span>] No tests were executed.</a>
<a class="sourceLine" id="cb8-30" title="30">[<span class="ex">success</span>] Total time: 1 s, completed Dec 9, 2018 6:47:43 AM</a>
<a class="sourceLine" id="cb8-31" title="31"></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="op">&gt;</span> <span class="ex">layer_Y_JVM_persistence/test</span></a>
<a class="sourceLine" id="cb8-33" title="33"></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="ex">...</span> output of tests running ...</a>
<a class="sourceLine" id="cb8-35" title="35"></a>
<a class="sourceLine" id="cb8-36" title="36">[<span class="ex">info</span>] Run completed in 1 second, 747 milliseconds.</a>
<a class="sourceLine" id="cb8-37" title="37">[<span class="ex">info</span>] Total number of tests run: 4</a>
<a class="sourceLine" id="cb8-38" title="38">[<span class="ex">info</span>] Suites: completed 3, aborted 0</a>
<a class="sourceLine" id="cb8-39" title="39">[<span class="ex">info</span>] Tests: succeeded 4, failed 0, canceled 0, ignored 0, pending 0</a>
<a class="sourceLine" id="cb8-40" title="40">[<span class="ex">info</span>] All tests passed.</a>
<a class="sourceLine" id="cb8-41" title="41">[<span class="ex">success</span>] Total time: 3 s, completed Dec 9, 2018 6:53:33 AM</a>
<a class="sourceLine" id="cb8-42" title="42"></a>
<a class="sourceLine" id="cb8-43" title="43"><span class="op">&gt;</span> <span class="ex">layer_Z_JVM_and_JS_sharedJVM/test</span></a>
<a class="sourceLine" id="cb8-44" title="44"></a>
<a class="sourceLine" id="cb8-45" title="45"><span class="ex">...</span> output of tests running ...</a>
<a class="sourceLine" id="cb8-46" title="46"></a>
<a class="sourceLine" id="cb8-47" title="47">[<span class="ex">info</span>] Run completed in 693 milliseconds.</a>
<a class="sourceLine" id="cb8-48" title="48">[<span class="ex">info</span>] Total number of tests run: 6</a>
<a class="sourceLine" id="cb8-49" title="49">[<span class="ex">info</span>] Suites: completed 3, aborted 0</a>
<a class="sourceLine" id="cb8-50" title="50">[<span class="ex">info</span>] Tests: succeeded 6, failed 0, canceled 0, ignored 0, pending 0</a>
<a class="sourceLine" id="cb8-51" title="51">[<span class="ex">info</span>] All tests passed.</a>
<a class="sourceLine" id="cb8-52" title="52">[<span class="ex">info</span>] Passed: Total 6, Failed 0, Errors 0, Passed 6</a>
<a class="sourceLine" id="cb8-53" title="53">[<span class="ex">success</span>] Total time: 2 s, completed Dec 9, 2018 6:57:20 AM</a>
<a class="sourceLine" id="cb8-54" title="54"></a>
<a class="sourceLine" id="cb8-55" title="55"></a>
<a class="sourceLine" id="cb8-56" title="56"><span class="co"># we can also test the same code but compiled to javascript by :</span></a>
<a class="sourceLine" id="cb8-57" title="57"></a>
<a class="sourceLine" id="cb8-58" title="58"><span class="op">&gt;</span> <span class="ex">layer_Z_JVM_and_JS_sharedJS/test</span> </a>
<a class="sourceLine" id="cb8-59" title="59"></a>
<a class="sourceLine" id="cb8-60" title="60"><span class="co"># in this case - first - the `.js` file `layer_z_js_shared-test-fastopt.js` </span></a>
<a class="sourceLine" id="cb8-61" title="61"><span class="co"># - needed for testing - will be built :</span></a>
<a class="sourceLine" id="cb8-62" title="62"></a>
<a class="sourceLine" id="cb8-63" title="63">[<span class="ex">info</span>] Updating <span class="dt">{file:/Users/joco/dev/IM/im-2018jan/}</span>layer_Z_JVM_and_JS_sharedJS...</a>
<a class="sourceLine" id="cb8-64" title="64">[<span class="ex">info</span>] Resolving org.eclipse.jetty#jetty-continuation<span class="kw">;</span><span class="ex">8.1.16.v20140903</span> ...</a>
<a class="sourceLine" id="cb8-65" title="65">[<span class="ex">info</span>] Done updating.</a>
<a class="sourceLine" id="cb8-66" title="66">[<span class="ex">info</span>] Compiling 34 Scala sources to /Users/joco/dev/IM/im-2018jan/layer_Z_JVM_and_JS_shared/.js/target/scala-2.12/classes...</a>
<a class="sourceLine" id="cb8-67" title="67">[<span class="ex">warn</span>] there were two feature warnings<span class="kw">;</span> <span class="ex">re-run</span> with -feature for details</a>
<a class="sourceLine" id="cb8-68" title="68">[<span class="ex">warn</span>] one warning found</a>
<a class="sourceLine" id="cb8-69" title="69">[<span class="ex">info</span>] Compiling 5 Scala sources to /Users/joco/dev/IM/im-2018jan/layer_Z_JVM_and_JS_shared/.js/target/scala-2.12/test-classes...</a>
<a class="sourceLine" id="cb8-70" title="70">[<span class="ex">info</span>] Fast optimizing /Users/joco/dev/IM/im-2018jan/layer_Z_JVM_and_JS_shared/.js/target/scala-2.12/layer_z_js_shared-test-fastopt.js</a>
<a class="sourceLine" id="cb8-71" title="71"></a>
<a class="sourceLine" id="cb8-72" title="72"><span class="ex">...</span> output of tests running ...</a>
<a class="sourceLine" id="cb8-73" title="73"></a>
<a class="sourceLine" id="cb8-74" title="74">[<span class="ex">info</span>] Run completed in 9 seconds, 594 milliseconds.</a>
<a class="sourceLine" id="cb8-75" title="75">[<span class="ex">info</span>] Total number of tests run: 6</a>
<a class="sourceLine" id="cb8-76" title="76">[<span class="ex">info</span>] Suites: completed 3, aborted 0</a>
<a class="sourceLine" id="cb8-77" title="77">[<span class="ex">info</span>] Tests: succeeded 6, failed 0, canceled 0, ignored 0, pending 0</a>
<a class="sourceLine" id="cb8-78" title="78">[<span class="ex">info</span>] All tests passed.</a>
<a class="sourceLine" id="cb8-79" title="79">[<span class="ex">success</span>] Total time: 16 s, completed Dec 9, 2018 7:05:26 AM</a></code></pre></div>
<p>In short, you can also execute the following command in <code>bash</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">./runUnitTestsForServer.sh</span></a></code></pre></div>
<h2 id="integration-testing-client---server"><span class="header-section-number">4.2</span> Integration testing (client &lt;-&gt; server)</h2>
<ul>
<li>Execute the code below for compiling and building client side (integration) test code:</li>
</ul>
<pre><code>sbt
&gt; project layer_V_JS_client
&gt; test:clean
&gt; test:compile
&gt; test:fastOptJS
</code></pre>
<p>The last command should give something like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="op">&gt;</span> <span class="ex">test</span>:fastOptJS</a>
<a class="sourceLine" id="cb11-2" title="2">[<span class="ex">info</span>] Fast optimizing /Users/joco/dev/IM/im-2018jan/layer_V_JS_client/target/scala-2.12/layer_v_js_client-test-fastopt.js</a>
<a class="sourceLine" id="cb11-3" title="3">[<span class="ex">success</span>] Total time: 14 s, completed Dec 10, 2018 8:27:23 AM</a></code></pre></div>
<ul>
<li>Start a test server ( with <code>utils/runTestServerInSbt.sh</code> )</li>
<li>Execute the integration tests. There are two possibilities for doing this :
<ul>
<li><code>node</code> : running the integration tests on <code>node</code></li>
<li><code>karma</code> : running the integration tests in the browser</li>
</ul></li>
</ul>
<h1 id="generating-html-for-readmemd"><span class="header-section-number">5</span> Generating html for README.md</h1>
<ul>
<li>Install <code>pandoc</code></li>
<li>Execute <code>utils/markdown/generateHtmlForREADME.sh</code> in the base directory (where <code>README.md</code> is)</li>
</ul>
</body>
</html>
